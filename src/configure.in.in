
#DO_NOT_COMPILE="$DO_NOT_COMPILE kexi"

KEXI_VERSION=0.1b1.91

# -- Check for KDE 3.1 and enable the compat dir --------------------

AC_MSG_CHECKING([for kdelibs newer than 3.1.x])

AC_LANG_SAVE
AC_LANG_CPLUSPLUS
kcompat_save_CXXFLAGS="$CXXFLAGS"
kcompat_safe_LIBS="$LIBS"
LIBS="$LIBS $X_EXTRA_LIBS"
CXXFLAGS="$CXXFLAGS $all_includes"

AC_TRY_COMPILE([
#include <kdeversion.h>
#if !( KDE_IS_VERSION( 3, 1, 90 ) )
#error Need to enable kexi_compat
#endif
],
[
],
	use_kexi_compat_qextmdi="no"
	AC_SUBST(LIB_KEXI_KMDI, '-lkmdi')
	AC_MSG_RESULT(yes)
,
	use_kexi_compat_qextmdi="yes"
	kexi_compat_qextmdi_lib=libkexi_compat_qextmdi.so
	
	# lets find qextmdi includes and lib:
	
	dnl looking for $kexi_compat_qextmdi_lib
	kexi_compat_qextmdi_errmsg="For kde3.1 qextmdi library is needed from http://kexi-project.org/devresources.html"
	AC_FIND_FILE($kexi_compat_qextmdi_lib, $kde_libraries, kexi_compat_qextmdi_dir)
#	AC_FIND_FILE($kexi_compat_qextmdi_lib, $kde_libdirs, kexi_compat_qextmdi_dir)
	if test ! -r "$kexi_compat_qextmdi_dir/$kexi_compat_qextmdi_lib"; then
		AC_MSG_WARN([No $kexi_compat_qextmdi_lib found in $kde_libraries !])
        	use_kexi_compat_qextmdi="do_not_compile"
                DO_NOT_COMPILE="$DO_NOT_COMPILE kexi"
	fi
	AC_FIND_FILE(dockmainwindow_compat.h, $kde_includes/kexi/compat/qextmdi, kexi_compat_qextmdi_includes)
	if test ! -r "$kexi_compat_qextmdi_includes"; then
		AC_MSG_WARN([No kexi/compat/qextmdi includes found in $kde_includes !])
        	use_kexi_compat_qextmdi="do_not_compile"
                DO_NOT_COMPILE="$DO_NOT_COMPILE kexi"
	fi
	
	AC_SUBST(LIB_KEXI_KMDI_INCLUDES, '-I'$kexi_compat_qextmdi_includes)
	AC_SUBST(LIB_KEXI_KMDI, -lkexi_compat_qextmdi)
	
	AC_MSG_RESULT(no)
	echo "  libkexi_compat_qextmdi will be used instead of libkmdi."
)
CXXFLAGS="$kcompat_save_CXXFLAGS"
LIBS="$kcompat_safe_LIBS"
AC_LANG_RESTORE

AM_CONDITIONAL(use_kexi_compat_qextmdi, test "$use_kexi_compat_qextmdi" = "yes")

# -- End KDE 3.1 check ----------------------------------------------

