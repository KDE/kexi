dnl ================
dnl checks for QSA
dnl ================

dnl if QSA is avaible compile kexi's QSA plugin with it

AC_MSG_CHECKING([for qsa])

compile_qsa_plugin="yes"

dnl check header files
qsa_incdirs=$QTDIR/include
AC_FIND_FILE(qsinterpreter.h, $qsa_incdirs, qsa_incdir)
if test ! -r $qsa_incdir/qsinterpreter.h; then
  compile_qsa_plugin="no"
else
  QSA_INCDIR=$qsa_incdir
  AC_SUBST(QSA_INCDIR)
fi

dnl check libraries
qsa_libdirs=$QTDIR/lib
AC_FIND_FILE(libqsa.so, $qsa_libdirs, qsa_libdir)
if test ! -r $qsa_libdir/libqsa.so; then
  compile_qsa_plugin="no"
else


AC_LANG_SAVE
AC_LANG_CPLUSPLUS
ac_cxxflags_safe="$CXXFLAGS"
CXXFLAGS="$CXXFLAGS -I$qsa_incdirs"

AC_TRY_LINK([
   #include <qsaglobal.h>
 ],
 [
 #ifndef QSA_VERSION_BETA
 #error "WRONG VERSION"
 #endif
 ],
  compile_qsa_plugin="yes",
  compile_qsa_plugin="no"
 )

  if test "$compile_qsa_plugin" = "yes"; then
    QSA_LIBDIR=$qsa_libdir
    AC_SUBST(QSA_LIBDIR)
  fi

CXXFLAGS="$ac_cxxflags_safe"
AC_LANG_RESTORE
fi


if test "$compile_qsa_plugin" = "yes"; then
  AC_MSG_RESULT([libraries $qsa_libdir, headers $qsa_incdir])
else
  AC_MSG_RESULT(not found)
  AC_MSG_WARN([qsa >= 20030301 could not be found anywhere, kexi will compile without scripting support. check ftp.trolltech.com for qsa >=20030301])
fi

AM_CONDITIONAL(compile_qsa_plugin, test "$compile_qsa_plugin" = "yes")

