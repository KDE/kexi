dnl ================
dnl checks for MySQL
dnl tooken form KDEDB
dnl ================

AC_ARG_ENABLE(mysql, [  --enable-mysql              build MySQL-plugin [default=yes]],
              mysql_plugin=$enableval, mysql_plugin=yes)

AC_ARG_WITH(mysql_includes,
[  --with-mysql-includes=DIR   use MySQL-includes installed in this directory ],
[
  ac_mysql_incdir=$withval
], ac_mysql_incdir=/usr/local/include
)

AC_ARG_WITH(mysql_libraries,
[  --with-mysql-libraries=DIR  use MySQL-libs installed in this directory ],
[
  ac_mysql_libdir=$withval
], ac_mysql_libdir=/usr/local/lib
)

dnl check for MySQL should be compiled
dnl and where headers and libraries are installed
dnl if present compile mysql-plugin

AC_MSG_CHECKING([for MySQL])

compile_mysql_plugin="yes"

if test "x$mysql_plugin" != "xyes"; then
  compile_mysql_plugin="no"
fi

dnl check header files
mysql_incdirs="$ac_mysql_incdir /usr/include /usr/include/mysql /usr/local/include/mysql /usr/local/include"
AC_FIND_FILE(mysql.h, $mysql_incdirs, mysql_incdir)
if test ! -r $mysql_incdir/mysql.h; then
  compile_mysql_plugin="no"
else
  MYSQL_INCDIR=$mysql_incdir
  AC_SUBST(MYSQL_INCDIR)
fi

dnl check libraries
mysql_libdirs="$ac_mysql_libdir /usr/lib /usr/lib/mysql /usr/local/lib/mysql /usr/local/lib"
AC_FIND_FILE(libmysqlclient.la, $mysql_libdirs, mysql_libdir)
if test ! -r $mysql_libdir/libmysqlclient.la; then
    AC_FIND_FILE(libmysqlclient.so, $mysql_libdirs, mysql_libdir)
    if test ! -r $mysql_libdir/libmysqlclient.so; then
        compile_mysql_plugin="no"
    else
        MYSQL_LIBDIR=$mysql_libdir
        AC_SUBST(MYSQL_LIBDIR)
    fi
else
  MYSQL_LIBDIR=$mysql_libdir
  AC_SUBST(MYSQL_LIBDIR)
fi

if test "$compile_mysql_plugin" = "yes"; then
  AC_MSG_RESULT([libraries $mysql_libdir, headers $mysql_incdir])
else
  AC_MSG_RESULT(not found)
fi

AM_CONDITIONAL(compile_mysql_plugin, test "$compile_mysql_plugin" = "yes")

